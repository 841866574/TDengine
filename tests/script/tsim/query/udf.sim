system sh/stop_dnodes.sh

system sh/deploy.sh -n dnode1 -i 1
system sh/cfg.sh -n dnode1 -c wallevel -v 2
system sh/cfg.sh -n dnode1 -c numOfMnodes -v 1

print ========= start dnode1 as LEADER
system sh/exec.sh -n dnode1 -s start
sleep 2000
sql connect

print ======== step1 udf 
system sh/copy_udf.sh
sql create database udf vgroups 3;
sql use udf;
sql show databases;

sql create table t (ts timestamp, f int);
sql insert into t values(now, 1)(now+1s, 2);

sql create function udf1 as '/tmp/udf/libudf1.so' outputtype int bufSize 8;
sql create aggregate function udf2 as '/tmp/udf/libudf2.so' outputtype double bufSize 8;
sql show functions;
if $rows != 2 then
  return -1
endi
sql select udf1(f) from t;
if $rows != 2 then
  return -1
endi
if $data00 != 88 then
  return -1
endi
if $data10 != 88 then
  return -1
endi

sql select udf2(f) from t;
if $rows != 1 then
  return -1
endi
if $data00 != 2.236067977 then
  return -1
endi

#sql drop function udf1;
#sql drop function udf2;
system sh/exec.sh -n dnode1 -s stop -x SIGKILL
