system sh/stop_dnodes.sh
system sh/deploy.sh -n dnode1 -i 1
system sh/deploy.sh -n dnode2 -i 2
system sh/deploy.sh -n dnode3 -i 3
system sh/deploy.sh -n dnode4 -i 4

system sh/cfg.sh -n dnode1 -c supportVnodes -v 0

system sh/exec.sh -n dnode1 -s start
system sh/exec.sh -n dnode2 -s start
system sh/exec.sh -n dnode3 -s start
system sh/exec.sh -n dnode4 -s start

#$loop_cnt = 0
#check_dnode_ready:
#	$loop_cnt = $loop_cnt + 1
#	sleep 200
#	if $loop_cnt == 10 then
#	  print ====> dnode not ready!
#		return -1
#	endi
#sql show dnodes
#print ===> $rows $data00 $data01 $data02 $data03 $data04 $data05
#print ===> $rows $data10 $data11 $data12 $data13 $data14 $data15
#print ===> $rows $data20 $data21 $data22 $data23 $data24 $data25
#if $data00 != 1 then
#  return -1
#endi
#if $data04 != ready then
#  goto check_dnode_ready
#endi
sleep 500
sql connect
sql create dnode $hostname port 7200
sql create dnode $hostname port 7300
sql create dnode $hostname port 7400

$loop_cnt = 0
check_dnode_ready_1:
	$loop_cnt = $loop_cnt + 1
	sleep 200
	if $loop_cnt == 10 then
	  print ====> dnode not ready!
		return -1
	endi
sql show dnodes
print ===> rows: $rows 
print ===> $data00 $data01 $data02 $data03 $data04 $data05
print ===> $data10 $data11 $data12 $data13 $data14 $data15
print ===> $data20 $data21 $data22 $data23 $data24 $data25
if $data00 != 1 then
  return -1
endi
if $data01 != localhost:7100 then
  return -1
endi
if $data04 != ready then
  goto check_dnode_ready_1
endi
if $data14 != ready then
  goto check_dnode_ready_1
endi
if $data24 != ready then
  goto check_dnode_ready_1
endi

print ============= create database
sql create database d0 replica 3 vgroups 1
sleep 3000
sql show databases
print ===> rows: $rows
print ===> $data00 $data01 $data02 $data03 $data04 $data05 $data06 $data07 $data08 $data09
print ===> $data10 $data11 $data12 $data13 $data14 $data15 $data16 $data17 $data18 $data19
print ===> $data20 $data21 $data22 $data23 $data24 $data25 $data26 $data27 $data28 $data29
print ====> dataX_db
print $data0_db $data1_db $data2_db $data3_db $data4_db $data5_db $data6_db $data7_db $data8_db $data9_db $data10_db $data11_db $data12_db $data13_db $data14_db $data15_db $data16_db $data17_db

#if $rows != 2 then
#  return -1
#endi

sql use d0
sql show vgroups
print ===> rows: $rows
print ===> $data00 $data01 $data02 $data03 $data04 $data05 $data06 $data07 $data08 $data09
print ===> $data10 $data11 $data12 $data13 $data14 $data15 $data16 $data17 $data18 $data19
print ===> $data20 $data21 $data22 $data23 $data24 $data25 $data26 $data27 $data28 $data29

print =============== create normal table, include column type for count/sum/min/max/first
sql create table if not exists ntb (ts timestamp, c1 int, c2 float, c3 double)

sql show tables
print ====> rows: $rows 
if $rows != 1 then 
  return -1
endi

print =============== insert data
sql insert into ntb values(now+0s, 10, 2.0, 3.0)
sql insert into ntb values(now+1s, 11, 2.1, 3.1)(now+2s, -12, -2.2, -3.2)(now+3s, -13, -2.3, -3.3)

#===================================================================
#===================================================================
print =============== query data from child table
sql select * from ntb
print rows: $rows 
print $data00  $data01 $data02 $data03
print $data10  $data11 $data12 $data13
print $data20  $data21 $data22 $data23
print $data30  $data31 $data32 $data33
if $rows != 4 then
  return -1
endi
if $data01 != 10 then 
  return -1
endi
if $data02 != 2.00000 then 
  return -1
endi
if $data03 != 3.000000000 then 
  return -1
endi


print =============== query data from stable
sql select count(*) from ntb
print rows: $rows 
print $data00  $data01 $data02 $data03
if $data00 != 4 then
  return -1
endi





system sh/exec.sh -n dnode1 -s stop -x SIGINT
system sh/exec.sh -n dnode2 -s stop -x SIGINT
system sh/exec.sh -n dnode3 -s stop -x SIGINT
system sh/exec.sh -n dnode4 -s stop -x SIGINT
